{"version":3,"sources":["checkout.js"],"names":[],"mappings":";;AAAA;;;;;;;AAOA,CAAC,YAAI;;AAED,MAAE,2BAAF,EAA+B,MAA/B,CAAsC,YAAU;AAC7C,UAAE,aAAF,EAAiB,WAAjB,CAA6B,MAA7B;AACF,KAFD;;AAIA,MAAE,gCAAF,EAAoC,MAApC,CAA2C,YAAU;AACjD,UAAE,aAAF,EAAiB,QAAjB,CAA0B,MAA1B;AACH,KAFD;AAGA;AACA,MAAE,IAAF,CAAO;AACH,aAAI,iBADD;AAEH,cAAK,KAFF;AAGH,iBAAQ,iBAAS,IAAT,EAAc;AAClB,gBAAI,MAAK,EAAE,2BAAF,CAAT;AACA,oBAAQ,GAAR,CAAY,GAAZ;AACA,gBAAG,KAAK,GAAL,IAAU,MAAb,EAAoB;;AAEhB,sBAAM,OAAN;AACA,yBAAS,IAAT,GAAc,YAAd;AAEH,aALD,MAKM,IAAG,KAAK,GAAL,IAAU,MAAb,EAAoB;AACtB,oBAAI,IAAJ,CAAS,0DAAT;AACA,kBAAE,aAAF,EAAiB,WAAjB,CAA6B,MAA7B;AACA,kBAAE,oBAAF,EAAwB,IAAxB,CAA6B,SAA7B,EAAuC,SAAvC;AACH,aAJK,MAID;AACD,oBAAI,OAAM,EAAV;AACA,qBAAI,IAAI,CAAR,IAAa,IAAb,EAAkB;AACd,wBAAI,IAAG,KAAK,CAAL,CAAP;AACA,iDAAwB,EAAE,GAA1B,iCAAsD,EAAE,QAAxD,SAAoE,EAAE,SAAtE,SAAmF,EAAE,MAArF;AACH;AACD,oBAAI,IAAJ,CAAS,IAAT;AACH;AACJ,SAvBE;AAwBH,eAAM,iBAAU;AACZ,kBAAM,MAAN;AACH;AA1BE,KAAP;AA4BA;AACA,MAAE,YAAF,EAAgB,MAAhB,CAAuB,UAAS,CAAT,EAAW;AAC9B,UAAE,cAAF;AACA,YAAI,QAAM,EAAE,OAAF,EAAW,GAAX,EAAV;AACA,YAAI,SAAO,EAAE,QAAF,EAAY,GAAZ,EAAX;AACA,YAAI,WAAS,EAAE,UAAF,EAAc,GAAd,EAAb;AACA,UAAE,IAAF,CAAO;AACH,iBAAI,iBADD;AAEH,kBAAK,MAFF;AAGH,kBAAK;AACD,2BAAU,KADT;AAED,wBAAO,MAFN;AAGD,0BAAS;AAHR,aAHF;AAQH,qBAAQ,iBAAS,IAAT,EAAc;AAClB,oBAAG,KAAK,GAAL,IAAU,MAAb,EAAoB;AAChB,0BAAM,OAAN;AACA,6BAAS,IAAT,GAAc,YAAd;AACH,iBAHD,MAGM,IAAG,KAAK,EAAL,IAAS,CAAZ,EAAc;AAChB,6BAAS,MAAT,EAAgB,KAAK,GAArB,EAAyB,KAAzB,EAA+B,IAA/B,EAAoC,IAApC,EAAyC,YAAU,CAAE,CAArD;AACA;AACH,iBAHK,MAGA,IAAG,KAAK,EAAL,IAAS,CAAZ,EAAc;AAChB,6BAAS,MAAT,EAAgB,KAAK,GAArB,EAAyB,KAAzB,EAA+B,IAA/B,EAAoC,IAApC,EAAyC,YAAU;AAAC,iCAAS,MAAT;AAAmB,qBAAvE;AAEH;AACJ,aAnBE;AAoBH,mBAAM,iBAAU;AACZ,yBAAS,MAAT,EAAgB,MAAhB,EAAuB,KAAvB,EAA6B,IAA7B,EAAkC,IAAlC,EAAuC,YAAU,CAAE,CAAnD;AACH;AAtBE,SAAP;;AAyBA,eAAO,KAAP;AACH,KA/BD;;AAkCA;AACA,MAAE,IAAF,CAAO;AACH,aAAI,kBADD;AAEH,cAAK,KAFF;AAGH,iBAAQ,iBAAS,IAAT,EAAc;AAClB,gBAAG,KAAK,EAAL,IAAS,CAAZ,EAAc;AACV,sBAAM,OAAN;AACA,yBAAS,IAAT,GAAc,YAAd;AACH,aAHD,MAGM,IAAG,KAAK,MAAL,IAAa,CAAhB,EAAkB;AACpB,oBAAI,SAAO,EAAE,eAAF,CAAX;AACA,oBAAI,OAAK,EAAT;AACA,kBAAE,IAAF,EAAQ,IAAR,CAAa,UAAS,CAAT,EAAW,CAAX,EAAa;AACtB,4GAC4B,EAAE,EAD9B,qCAC6D,EAAE,KAD/D,gEAEwB,EAAE,MAF1B,sFAGuC,EAAE,KAHzC,wBAGiE,EAAE,MAHnE;AAKH,iBAND;;AAQA,uBAAO,IAAP,CAAY,IAAZ;AACA;AACH,aAbK,MAaA,IAAG,CAAC,KAAK,MAAT,EAAgB;AAClB,sBAAM,WAAN;AACA,yBAAS,IAAT,GAAc,YAAd;AACH;AACJ,SAxBE;AAyBH,eAAM,iBAAU;AACZ,kBAAM,MAAN;AACA,qBAAS,IAAT,GAAc,YAAd;AACH;AA5BE,KAAP;;AAgCA;AACA,aAAS,aAAT,GAAwB;AACpB,YAAI,QAAM,CAAV;AACA,YAAI,SAAS,EAAE,qBAAF,CAAb;AACA,YAAI,SAAQ,EAAE,aAAF,CAAZ;;AAEA,eAAO,IAAP,CAAY,UAAS,CAAT,EAAW,IAAX,EAAgB;AACxB,gBAAI,QAAQ,WAAW,EAAE,IAAF,EAAQ,IAAR,CAAa,YAAb,EAA2B,IAA3B,EAAX,CAAZ;AACA,gBAAI,QAAQ,SAAS,EAAE,IAAF,EAAQ,IAAR,CAAa,YAAb,EAA2B,IAA3B,EAAT,CAAZ;AACA,qBAAO,QAAM,KAAb;AACH,SAJD;AAKA,eAAO,IAAP,CAAY,MAAM,OAAN,CAAc,CAAd,CAAZ;AACH;AACD;AACA,MAAE,UAAF,EAAc,KAAd,CAAoB,YAAU;AAC1B,YAAI,MAAI,EAAE,2BAAF,EAA+B,GAA/B,EAAR;AACA,YAAI,SAAS,EAAE,yBAAF,EAA6B,GAA7B,EAAb;AACA,YAAI,aAAY,EAAE,gCAAF,EAAoC,GAApC,EAAhB;;AAEA,UAAE,IAAF,CAAO;AACH,iBAAI,qBADD;AAEH,kBAAK,MAFF;AAGH,kBAAK;AACD,qBAAI,GADH;AAED,wBAAO,MAFN;AAGD,4BAAW;AAHV,aAHF;AAQH,qBAAQ,iBAAS,IAAT,EAAc;AAClB,oBAAG,KAAK,EAAL,IAAS,CAAZ,EAAc;AACV,6BAAS,IAAT,GAAc,WAAd;AACH,iBAFD,MAEK;AACD,6BAAS,MAAT,EAAgB,MAAhB,EAAuB,KAAvB,EAA6B,IAA7B,EAAkC,IAAlC,EAAuC,YAAU,CAAE,CAAnD;AACH;AACJ,aAdE;AAeH,mBAAM,iBAAU;AACZ,sBAAM,MAAN;AACA,yBAAS,IAAT,GAAc,YAAd;AACH;AAlBE,SAAP;AAqBH,KA1BD;AA2BA;AACA,aAAS,OAAT,GAAkB;AACd,UAAE,IAAF,CAAO;AACH,iBAAI,kBADD;AAEH,kBAAK,KAFF;AAGH,qBAAQ,iBAAS,IAAT,EAAc;AAClB,oBAAG,KAAK,EAAL,IAAS,CAAZ,EACI,EAAE,sBAAF,EAA0B,IAA1B,CAA+B,KAAK,MAApC,EADJ,KAEM,EAAE,sBAAF,EAA0B,IAA1B,CAA+B,CAA/B;AACT;AAPE,SAAP;AASH;;AAKD;;AAEA,aAAS,QAAT,CAAkB,KAAlB,EAAwB,GAAxB,EAA4B,SAA5B,EAAsC,IAAtC,EAA2C,IAA3C,EAAgD,QAAhD,EAAyD;AACrD,YAAI,SAAQ,EAAE,WAAF,CAAZ;AACA,eAAO,IAAP,CAAY,cAAZ,EAA4B,IAA5B,CAAiC,KAAjC;AACA,eAAO,IAAP,CAAY,aAAZ,EAA2B,IAA3B,CAAgC,GAAhC;AACA,eAAO,IAAP,CAAY,4BAAZ,EAA0C,IAA1C,CAA+C,IAA/C;;AAEA,YAAG,CAAC,SAAJ,EAAc;AACV,mBAAO,IAAP,CAAY,4BAAZ,EAA0C,QAA1C,CAAmD,MAAnD;AACA,mBAAO,IAAP,CAAY,4BAAZ,EAA0C,IAA1C,CAA+C,IAA/C,EAAqD,EAArD,CAAwD,OAAxD,EAAgE,QAAhE;AACH,SAHD,MAGK;AACD,mBAAO,IAAP,CAAY,4BAAZ,EAA0C,IAA1C,CAA+C,IAA/C,EAAqD,EAArD,CAAwD,OAAxD,EAAgE,QAAhE;AACH;;AAGD,eAAO,KAAP,CAAa,MAAb;AACH;AAIJ,CAxLD","file":"checkout-s.js","sourcesContent":["/**\r\n *收银台  创建订单\r\n * 根据服务器端session uid获取收货地址\r\n * 获取购物车订单内容\r\n * 计算订单总价格等\r\n * 提交后 将创建订单\r\n */\r\n(()=>{\r\n\r\n    $(\".radio input[value='new']\").change(function(){\r\n       $(\".new_adress\").removeClass(\"hide\");\r\n    });\r\n\r\n    $(\".radio input[value='existing']\").change(function(){\r\n        $(\".new_adress\").addClass(\"hide\");\r\n    });\r\n    /*获取收货地址*/\r\n    $.ajax({\r\n        url:\"data/getadr.php\",\r\n        type:\"get\",\r\n        success:function(data){\r\n            var sad =$(\"select[name='address_id']\");\r\n            console.log(sad);\r\n            if(data.msg==\"fail\"){\r\n\r\n                alert(\"请先登录!\");\r\n                location.href=\"login.html\";\r\n\r\n            }else if(data.msg==\"null\"){\r\n                sad.html('<option value=\"-1\" selected=\"selected\">请先添加收货地址</option>');\r\n                $(\".new_adress\").removeClass(\"hide\");\r\n                $(\"input[value='new']\").attr(\"checked\",\"checked\");\r\n            }else{\r\n                var html =\"\";\r\n                for(var x in data){\r\n                    var a =data[x];\r\n                    html+=`<option value=\"${a.aid}\" selected=\"selected\">${a.uaddress},${a.firstname},${a.uphone}</option>`;\r\n                }\r\n                sad.html(html);\r\n            }\r\n        },\r\n        error:function(){\r\n            alert(\"网络故障\");\r\n        }\r\n    });\r\n    /*添加收货地址*/\r\n    $(\".addr_form\").submit(function(e){\r\n        e.preventDefault();\r\n        var fname=$(\"#name\").val();\r\n        var uphone=$(\"#phone\").val();\r\n        var uaddress=$(\"#address\").val();\r\n        $.ajax({\r\n            url:\"data/addadr.php\",\r\n            type:\"post\",\r\n            data:{\r\n                firstname:fname,\r\n                uphone:uphone,\r\n                uaddress:uaddress\r\n            },\r\n            success:function(data){\r\n                if(data.msg==\"fail\"){\r\n                    alert(\"请先登录!\");\r\n                    location.href=\"login.html\";\r\n                }else if(data.ok==0){\r\n                    alertMsg(\"提示信息\",data.msg,false,\"关闭\",\"关闭\",function(){});\r\n                    //alert(data.msg);\r\n                }else if(data.ok==1){\r\n                    alertMsg(\"提示信息\",data.msg,false,\"关闭\",\"关闭\",function(){location.reload();});\r\n\r\n                }\r\n            },\r\n            error:function(){\r\n                alertMsg(\"提示信息\",\"网络故障\",false,\"关闭\",\"关闭\",function(){});\r\n            }\r\n        });\r\n\r\n        return false;\r\n    });\r\n\r\n\r\n    /*获取购物车的订单内容*/\r\n    $.ajax({\r\n        url:\"data/getcart.php\",\r\n        type:\"get\",\r\n        success:function(data){\r\n            if(data.ok==0){\r\n                alert(\"请先登录!\");\r\n                location.href=\"login.html\";\r\n            }else if(data.length!=0){\r\n                var $tbody=$(\"#list_content\");\r\n                var html=\"\";\r\n                $(data).each(function(i,d){\r\n                    html+=`  <tr class=\"cart_item\">\r\n                                <td><img src=\"${d.lg}\" width=70 alt=\"\"/> <span>${d.title}</span></td>\r\n                                <td><span>${d.fcount}</span></td>\r\n                                <td class=\"price\">￥<span>${d.price}</span> X <span>${d.fcount}</span></td>\r\n                            </tr>`;\r\n                });\r\n\r\n                $tbody.html(html);\r\n                setTotalPrice();\r\n            }else if(!data.length){\r\n                alert(\"订单列表获取失败!\");\r\n                location.href=\"index.html\";\r\n            }\r\n        },\r\n        error:function(){\r\n            alert(\"网络故障\");\r\n            location.href=\"index.html\";\r\n        }\r\n    });\r\n\r\n\r\n    /*计算总价格*/\r\n    function setTotalPrice(){\r\n        var total=0;\r\n        var prices = $(\".cart_item>td.price\");\r\n        var totalH= $(\".totalprice\");\r\n\r\n        prices.each(function(i,elem){\r\n            var price = parseFloat($(elem).find(\"span:eq(0)\").html());\r\n            var count = parseInt($(elem).find(\"span:eq(1)\").html());\r\n            total+=price*count;\r\n        });\r\n        totalH.html(total.toFixed(2));\r\n    }\r\n    /*提交订单*/\r\n    $(\".sublist\").click(function(){\r\n        var aid=$(\"select[name='address_id']\").val();\r\n        var common = $(\"textarea[name='common']\").val();\r\n        var pay_method =$(\"input[name='pay_ment']:checked\").val();\r\n\r\n        $.ajax({\r\n            url:\"data/createlist.php\",\r\n            type:\"post\",\r\n            data:{\r\n                aid:aid,\r\n                common:common,\r\n                pay_method:pay_method\r\n            },\r\n            success:function(data){\r\n                if(data.ok==1){\r\n                    location.href=\"list.html\";\r\n                }else{\r\n                    alertMsg(\"提示信息\",\"提交失败\",false,\"关闭\",\"关闭\",function(){});\r\n                }\r\n            },\r\n            error:function(){\r\n                alert(\"网络故障\");\r\n                location.href=\"index.html\";\r\n            }\r\n        })\r\n\r\n    });\r\n    /*顶部购物车数量加载*/\r\n    function upcount(){\r\n        $.ajax({\r\n            url:\"data/getcart.php\",\r\n            type:\"get\",\r\n            success:function(data){\r\n                if(data.ok!=0)\r\n                    $(\".top_cart>span:eq(0)\").html(data.length);\r\n                else  $(\".top_cart>span:eq(0)\").html(0);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n\r\n    /*弹出自定义模态框*/\r\n\r\n    function alertMsg(title,msg,isConfirm,btn1,btn2,callback){\r\n        var dialog= $(\"#alertmsg\");\r\n        dialog.find(\".modal-title\").html(title);\r\n        dialog.find(\".modal-body\").html(msg);\r\n        dialog.find(\".modal-footer>button:eq(0)\").html(btn1);\r\n\r\n        if(!isConfirm){\r\n            dialog.find(\".modal-footer>button:eq(1)\").addClass(\"hide\");\r\n            dialog.find(\".modal-footer>button:eq(0)\").html(btn2).on(\"click\",callback);\r\n        }else{\r\n            dialog.find(\".modal-footer>button:eq(1)\").html(btn2).on(\"click\",callback);\r\n        }\r\n\r\n\r\n        dialog.modal(\"show\");\r\n    }\r\n\r\n\r\n\r\n})();"]}