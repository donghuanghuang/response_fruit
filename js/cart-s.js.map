{"version":3,"sources":["cart.js"],"names":[],"mappings":"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","file":"cart-s.js","sourcesContent":["/*异步请求购物车内容*/\r\n/**\r\n * uid从服务器端session获取\r\n *\r\n * 如果没有登录 则需要先登录\r\n *\r\n * 删除购物车\r\n *\r\n * 清空购物车 等功能代码\r\n */\r\n\r\n(()=>{\r\n    /*获取购物车内容显示在页面中*/\r\n    $.ajax({\r\n        url:\"data/getcart.php\",\r\n        type:\"get\",\r\n\t\tsuccess:function(datas){\r\n\t\t\t        if(datas.ok==0){\r\n            alert(\"请先登录!\");\r\n            location.href=\"login.html\";\r\n        }else if(datas.length==0){\r\n            var html=\"<tr><td colspan='4' align='center'>您的购物车空空如也~</td></tr>\";\r\n            $(\"#items\").html(html);\r\n            $(\".clearcart\").parent().hide();\r\n            setTotalprice();\r\n        }else{\r\n            //console.log(datas);\r\n\r\n            var html=\"\";\r\n\r\n            for(var x in datas){\r\n                var data = datas[x];\r\n                html+=` <tr class=\"cart_item\">\r\n                        <td class=\"title\"><a href=\"product_detail.html?fid=${data.fid}\"><img src=\"${data.lg}\" width=70 alt=\"\"/></a> <a href=\"#\">${data.title}</a></td>\r\n                        <td class=\"count\"><input type=\"number\" data-fid=\"${data.fid}\" value=\"${data.fcount}\" max=\"99\" min=\"1\"/></td>\r\n                        <td class=\"price\">￥<span>${data.price}</span> X <span>${data.fcount}</span></td>\r\n                        <td><a href=\"#\" data-fid=\"${data.fid}\" class=\"btn-danger btn btn-xs\">删除</a></td>\r\n                    </tr>`;\r\n            }\r\n\r\n\r\n            $(\"#items\").html(html);\r\n            setTotalprice();\r\n        }\r\n        /*为数量填写框添加事件*/\r\n        $(\"#items td.count>input\").each(function(i,elem){\r\n            elem.onchange=function(){\r\n                var fcount =this.value;\r\n                var fid=$(this).data(\"fid\")\r\n                var oInput=$(this);\r\n                $.ajax({\r\n                    url:\"data/updatecart.php\",\r\n                    type:\"post\",\r\n                    data:{\r\n                        fid,\r\n                        fcount\r\n                    },\r\n                    success:function(data){\r\n                        //console.log(data);\r\n                        if(data.ok==1){\r\n                            oInput.parent().next().find(\"span:eq(1)\").html(fcount);\r\n                            setTotalprice();\r\n                        }else if(data.ok==0){\r\n                            alertMsg(\"未知错误\",\"未知错误,请联系管理员\",false,\"关闭\",\"关闭\",function(){location.reload()});\r\n                        }\r\n\r\n                    }\r\n                });\r\n\r\n            }\r\n        });\r\n\r\n        /*为每个删除按钮添加事件*/\r\n      $(\".cart_item td a[data-fid]\").each(function(i,elem){\r\n          var fid =$(elem).data(\"fid\");\r\n          elem.onclick=function(e){\r\n              e.preventDefault();\r\n              alertMsg(\"删除确认\",\"确认删除这个商品吗\",true,\"取消\",\"确认\",function(){\r\n                 // location.href=\"cart.html\";\r\n                  $.ajax({\r\n                      url:\"data/delcart.php\",\r\n                      type:\"post\",\r\n                      data:{\r\n                          fid:fid\r\n                      },\r\n\t\t\t\t\t  success:function(data){\r\n\t\t\t\t\t\tif(data.ok==1)\r\n                          location.reload();\r\n\t\t\t\t\t\telse{\r\n                          alertMsg(\"未知错误\",\"未知错误,请联系管理员\",false,\"关闭\",\"关闭\",function(){location.reload()});\r\n\r\n                      }\r\n\t\t\t\t\t  }\r\n                  });\r\n\r\n              });\r\n                //if(confirm(\"您确定要删除这件商品吗?\")){\r\n                //\r\n                //}\r\n          }\r\n      });\r\n\r\n\r\n        /*清空购物车*/\r\n        $(\".clearcart\").click(()=>{\r\n            alertMsg(\"删除确认\",\"您确定要清空购物车吗?\",true,\"取消\",\"确认\",function(){\r\n\r\n                // location.href=\"cart.html\";\r\n                $.ajax({\r\n                    url:\"data/delcart.php\",\r\n                    type:\"post\",\r\n                    data:{fid:-1},\r\n                    success:function(data){\r\n                        if(data.ok==1){\r\n                            //alertMsg(\"清空购物车成功\",\"清空购物车成功\",false,\"关闭\",\"关闭\",function(){location.reload()});\r\n                            location.reload();\r\n                        }\r\n                    }\r\n                })\r\n            });\r\n\r\n\r\n            //if(confirm(\"您确定要清空购物车吗?\")){\r\n            //\r\n            //}\r\n        });\r\n\t\t},\r\n        error:function(){\r\n            alert(\"网络故障\");\r\n        }\r\n    });\r\n\r\n\r\n    /*计算购物车总价格价格*/\r\n    function setTotalprice(){\r\n        var prices = $(\"#items td.price\");\r\n        var totalH = $(\".total_price h3:eq(0)\");\r\n\r\n        var total=0;\r\n\r\n        if(prices.length==0)\r\n            totalH.html(total+\".00\");\r\n       prices.each(function(i,elem){\r\n           var price = parseFloat($(elem).find(\"span:eq(0)\").html());\r\n           var count = parseInt($(elem).find(\"span:eq(1)\").html());\r\n           total+=price*count;\r\n       });\r\n        totalH.html(\"￥\"+total.toFixed(2));\r\n    }\r\n    /*顶部购物车数量加载*/\r\n    function upcount(){\r\n        $.ajax({\r\n            url:\"data/getcart.php\",\r\n            type:\"get\",\r\n            success:function(data){\r\n                if(data.ok!=0)\r\n                    $(\".top_cart>span:eq(0)\").html(data.length);\r\n                else  $(\".top_cart>span:eq(0)\").html(0);\r\n            }\r\n        });\r\n    }\r\n\r\n    /*弹出自定义模态框*/\r\n\r\n    function alertMsg(title,msg,isConfirm,btn1,btn2,callback){\r\n        var dialog= $(\"#alertmsg\");\r\n        dialog.find(\".modal-title\").html(title);\r\n        dialog.find(\".modal-body\").html(msg);\r\n        dialog.find(\".modal-footer>button:eq(0)\").html(btn1);\r\n\r\n        if(!isConfirm){\r\n            dialog.find(\".modal-footer>button:eq(1)\").addClass(\"hide\");\r\n            dialog.find(\".modal-footer>button:eq(0)\").html(btn2).on(\"click\",callback);\r\n        }else{\r\n            dialog.find(\".modal-footer>button:eq(1)\").html(btn2).on(\"click\",callback);\r\n        }\r\n\r\n\r\n        dialog.modal(\"show\");\r\n    }\r\n\r\n\r\n})();"]}