{"version":3,"sources":["detail.js"],"names":[],"mappings":"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","file":"detail-s.js","sourcesContent":["/**\r\n * 此文件存放商品详情页js代码\r\n * 根据地址栏fid 获取服务器端商品内容\r\n * 加载图片 加入购物车等事件\r\n * (加入购物车需要登录)\r\n * 放大镜功能\r\n */\r\n$(()=>{\r\n    var fid =location.search.split(\"fid=\")[1];\r\n    console.log(fid);\r\n    var mImg=$(\"#lg_pic > div > img\");\r\n    var sImg= $(\"#sm_pic\");\r\n    if(!fid)\r\n        fid=1;\r\n    $.ajax({\r\n        url:\"data/detail.php\",\r\n        type:\"get\",\r\n        data:\"fid=\"+fid,\r\n\t\tsuccess:function(data){\r\n\t\t\t        //加载图片\r\n        mImg.attr(\"src\",data.pics[0].lg);\r\n        var html=\"\";\r\n\r\n        for(var x in  data.pics){\r\n            var pic = data.pics[x];\r\n            html+=` <div class=\"col-xs-3\">\r\n                    <img src=\"${pic.sm}\" alt=\"\"/>\r\n                   </div>`;\r\n        }\r\n        sImg.html(html);\r\n\r\n        //加载商品详情\r\n\r\n        html  = `<li><span>尺寸:</span>${data.f_size}</li>\r\n                <li><span>成熟期:</span>${data.matures}</li>\r\n                <li><span>植株密度:</span>${data.p_spacing}</li>\r\n                <li><span>植株尺寸:</span>${data.p_size}</li>`;\r\n\r\n        $(\".product_pare >h1\").html(data.title)\r\n            .next().html(html)\r\n            .next().html(data.detail1)\r\n            .next().html(`￥${data.price}`);\r\n\r\n        $(\".reviews\").html(`${data.reviews} 人购买过`);\r\n\r\n        $(\".detail2\").html(data.detail2);\r\n\r\n        html=  `<li>卡路里: ${data.calories}</li>\r\n                <li>碳水化合物: ${data.carbohydrates}</li>\r\n                <li>纤维素: ${data.dietary}</li>\r\n                <li>蛋白质: ${data.protein}</li>\r\n                <li>糖类: ${data.Sugars}</li>\r\n                <li>维生素 A: ${data.va}</li>\r\n                <li>维生素 C: ${data.vc}</li>\r\n                <li>维生素 E: ${data.ve}</li>\r\n                <li>维生素 K: ${data.vk}</li>\r\n                <li>维生素 B6: ${data.vb6}</li>`;\r\n\r\n        $(\".desc > .spec\").html(html);\r\n\r\n\r\n\r\n        /*放大镜效果*/\r\n        var lgwrap=$(\".lgwrap\");\r\n\r\n        var smark=lgwrap.find(\".smark\");\r\n        var supermark=lgwrap.find(\".supermark\");\r\n        var superpic=lgwrap.find(\".superpic\");\r\n        sImg.on(\"click\",\"img\", function () {\r\n            mImg.attr(\"src\",$(this)[0].src);\r\n        });\r\n\r\n        supermark.on(\"mouseenter touchstart\",function () {\r\n            var oImgsrc=lgwrap.find(\"img\").attr(\"src\");\r\n            smark.removeClass('hide');\r\n            superpic.removeClass('hide').css(\"backgroundImage\",\"url(\"+oImgsrc+\")\");\r\n            superpic.css(\"backgroundSize\",supermark[0].offsetWidth*2+\"px \"+supermark[0].offsetHeight*2+\"px\");\r\n        });\r\n\r\n        supermark.on(\"mousemove touchmove\",function (e) {\r\n            var ev = e.originalEvent || e || e.event;\r\n            e.preventDefault();\r\n            var x,y,left,top,pleft=0;\r\n            if(ev.touches == undefined){\r\n                x =e.offsetX;\r\n                y =e.offsetY;\r\n\r\n            }else{\r\n                x = ev.touches[0].clientX-getTotalleft(supermark[0]);\r\n                y = ev.touches[0].pageY-getTotalTop(supermark[0]);\r\n            }\r\n            left = x-smark[0].offsetWidth/2;\r\n\r\n            top = y-smark[0].offsetHeight/2;\r\n\r\n            pleft=left;\r\n\r\n\r\n            left<0&&(left=0);\r\n            top<0&&(top=0);\r\n\r\n            left>supermark[0].offsetWidth-smark[0].offsetWidth&&(left=supermark[0].offsetWidth-smark[0].offsetWidth);\r\n            top>supermark[0].offsetHeight-smark[0].offsetHeight&&(top=supermark[0].offsetHeight-smark[0].offsetHeight);\r\n\r\n            smark.css({\"left\":left,\"top\":top});\r\n\r\n            pleft>supermark[0].offsetWidth-superpic[0].offsetWidth&&(pleft=supermark[0].offsetWidth-superpic[0].offsetWidth);\r\n\r\n            superpic.css({\"left\":pleft,\"top\":\"calc(\"+top+\"px - 50%)\",\"backgroundPosition\":-2*left+\"px \"+-2*top+\"px\"});\r\n\r\n        });\r\n\r\n        supermark.on(\"mouseleave touchend\",function () {\r\n            smark.addClass('hide');\r\n            superpic.addClass('hide');\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        var addcart =$(\".addcart\");\r\n        //加入购物车事件\r\n        addcart.click(function(){\r\n            $.ajax({\r\n                url:\"data/isLogin.php\",\r\n                type:\"get\",\r\n                success:function(data){\r\n                    if(data.ok==1){\r\n\r\n                        $.ajax({\r\n                            url:\"data/addcart.php\",\r\n                            type:\"get\",\r\n                            data:{\r\n                                fid:fid,\r\n                                fcount:addcart.prev().find(\"input\").val(),\r\n                                uid:data.uid\r\n                            },\r\n                            success:function(data2){\r\n                                if(data2.ok==1){\r\n                                    alertMsg(\"添加成功\",\"添加成功\",true,\"继续购物\",\"去购物车结算\",function(){location.href=\"cart.html\"});\r\n                                    //alert(\"添加成功!!\");\r\n                                    upcount();\r\n                                   // location.href=\"cart.html\"\r\n                                }\r\n\r\n                            },\r\n                            error:function(){\r\n                                alert(\"网络故障\");\r\n                            }\r\n                        })\r\n                    }else{\r\n                        alertMsg(\"请先登录\",\"请先登录\",false,\"关闭\",\"关闭\",function(){location.href=\"login.html\"});\r\n                        //location.href=\"login.html\";\r\n                    }\r\n                }\r\n            })\r\n\r\n\r\n\r\n        });\r\n\t\t}\r\n    });\r\n\r\n    function getTotalTop(elem){\r\n        var sum=0;\r\n        do{\r\n            sum+=elem.offsetTop;\r\n            elem=elem.offsetParent;\r\n        }while(elem);\r\n        return sum;\r\n    }\r\n\r\n    function getTotalleft(elem){\r\n        var sum=0;\r\n        do{\r\n            sum+=elem.offsetLeft;\r\n            elem=elem.offsetParent;\r\n        }while(elem);\r\n        return sum;\r\n    }\r\n    /*顶部购物车数量加载*/\r\n    function upcount(){\r\n        $.ajax({\r\n            url:\"data/getcart.php\",\r\n            type:\"get\",\r\n            success:function(data){\r\n                if(data.ok!=0)\r\n                    $(\".top_cart>span:eq(0)\").html(data.length);\r\n                else  $(\".top_cart>span:eq(0)\").html(0);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n\r\n\r\n    /*弹出自定义模态框*/\r\n\r\n    function alertMsg(title,msg,isConfirm,btn1,btn2,callback){\r\n        var dialog= $(\"#alertmsg\");\r\n        dialog.find(\".modal-title\").html(title);\r\n        dialog.find(\".modal-body\").html(msg);\r\n        dialog.find(\".modal-footer>button:eq(0)\").html(btn1);\r\n\r\n        if(!isConfirm){\r\n            dialog.find(\".modal-footer>button:eq(1)\").addClass(\"hide\");\r\n            dialog.find(\".modal-footer>button:eq(0)\").html(btn2).on(\"click\",callback);\r\n        }else{\r\n            dialog.find(\".modal-footer>button:eq(1)\").html(btn2).on(\"click\",callback);\r\n        }\r\n\r\n\r\n        dialog.modal(\"show\");\r\n    }\r\n\r\n\r\n});"]}